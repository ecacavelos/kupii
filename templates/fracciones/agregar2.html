{% extends "lotes/base_lotes.html" %}

{% block header_resources %}
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

{% endblock %}

{% block header_scripts %}

<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<script type="text/javascript">
		var data = [
	{"label" : "Aragorn"}
	];
	$(document).ready(function() {
	$( "#id_fecha_aprobacion" ).datepicker();
	$('.date').mask('##/##/####');
	var propietario_id;
	$("#id_name_propietario").empty();

	base_url = "/ajax/get_propietario_id_by_name/";
	params = "value";
	$( "#id_name_propietario" ).autocomplete({
	source:  base_url,
	minLength: 1,
	select: function( event, ui ) {
	id_propietario = ui.item.id;
	$("#id_propietario").val(id_propietario) ;

	}
	});
	});

	function validar_id_propietario(){
		if ($('#id_propietario').val() == '' || $('#id_propietario').val() == null ){
			var request_propietario_id = $.ajax({
				url : '/ajax/get_propietario_lastId/',
				type : "GET",
				success: function (data){
					$.each(data, function (index,value) {
					$("#id_propietario").val(value.id);
					var str = $("#id_superficie_total").val(); 
					var res = str.replace(" ","");
					//console.log("\n"+str);
					//console.log("\n"+res);
					$("#id_superficie_total").val(res);
					var dateTypeVar = $('#id_fecha_aprobacion').datepicker('getDate');
					$("#id_fecha_aprobacion").val($.datepicker.formatDate('yy-mm-dd', dateTypeVar));
					$("#form_add_fraccion").submit();
					});
				}
			});
	} else {
		var str = $("#id_superficie_total").val(); 
		var res = str.replace(" ","");
		//console.log("\n"+str);
		//console.log("\n"+res);
		$("#id_superficie_total").val(res);
		var dateTypeVar = $('#id_fecha_aprobacion').datepicker('getDate');
		$("#id_fecha_aprobacion").val($.datepicker.formatDate('yy-mm-dd', dateTypeVar));
		$("#form_add_fraccion").submit();
	}
}



function format(comma, period) {
  comma = comma || ',';
  period = period || '.';
  var split = this.toString().split('.');
  var numeric = split[0];
  var decimal = split.length > 1 ? period + split[1] : '';
  var reg = /(\d+)(\d{3})/;
  while (reg.test(numeric)) {
    numeric = numeric.replace(reg, '$1' + comma + '$2');
  }
  return numeric + decimal;
}

$('#id_superficie_total').on('keyup', function(){
    $(this).val(format.call($(this).val().split(' ').join(''),' ','.'));
});

</script>
{% endblock %}

{% block content %}
<div class="gri16 text-izquierda" id="breadcumb">
	<a href="/">Inicio</a><span class="verde-1">></span>
	<a href="/fracciones">Fracciones</a>
	<span class="verde-1">> Agregar Fracci&oacute;n</span>
</div>

<div class="clear"></div>

<div class="grid_10">
	<h1>Agregar Fracci&oacute;n</h1>
</div>

<div class="grid_6">
	<a href="#" class="historico">Buscar</a>
</div>

<div class="clear"></div>

<div class="grid_16" align="center">
	<form action="" method="post" id="form_add_fraccion">
		<table width="94%" border="0" cellpadding="0" cellspacing="0" id="forms" align="center">
			{% csrf_token %}
			{% for hidden in form.hidden_fields %}
			{{ hidden }}
			{% endfor %}

			{% for field in form %}
			<tr>
				{%if field.html_name == 'superficie_total' %}
				<td><strong>{{ field.label_tag }} Mts2:</strong></td>
				{%else%}
				<td><strong>{{ field.label_tag }}:</strong></td>
				{%endif%}
				{%if field.html_name == 'propietario' %}
				<td class="noimage">
				<input type="text" id="id_name_propietario" name="name_propietario" />
				{{ field.errors }}
				<br>
				<br>
				<a href="/propietarios/agregar/" class="boton-verde" target="_blank">Agregar Nuevo Propietario</a></td>
				{%else%}
					{%if field.html_name == 'superficie_total' %}
						<td class="noimage"><input type="text" name="superficie_total" id="id_superficie_total" onkeyup="$(this).val(format.call($(this).val().split(' ').join(''),' ','.'));"> {{ field.errors }}</td>
					{%else%}
						{%if field.html_name == 'fecha_aprobacion' %}
						<td class="noimage"><input type="text" name="fecha_aprobacion" id="id_fecha_aprobacion" class="date"> {{ field.errors }}</td>
						{%else%}
						<td class="noimage">{{ field }} {{ field.errors }}</td>
						{%endif%}	
					{%endif%}
				
				{%endif%}
			</tr>
			{% endfor %}

		</table>
		<input name="" type="button" value="Grabar" style="margin-bottom: 10px; cursor: pointer;" onclick="validar_id_propietario();" />
	</form>

	<div class="clear"></div>
</div>
{% endblock %}